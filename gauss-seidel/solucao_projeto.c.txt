#include <stdio.h>
#include <string.h>

int i,j,k,ordem;
float matriz[20][20],c,x[10],soma=0.0;

    
    int ehAplicavel() // testar se e possivel resolver o sistema dividindo a linha por                     outra linha
    {
         float divisaoLinhas[ordem];
         float resultadoDivisao[ordem];
         memset(divisaoLinhas, 0, sizeof(divisaoLinhas));
         memset(resultadoDivisao, 0, sizeof(resultadoDivisao));
         for (int linha = 1; linha <= ordem; linha++) 
         {
            for (int coluna = 1; coluna <= ordem+1; coluna++) 
            {
                divisaoLinhas[coluna] = matriz[linha][coluna];
            }
            
              for (int coluna = 1; coluna <= ordem; coluna++) 
            {
                if( divisaoLinhas[coluna] > matriz[linha+1][coluna])
                    resultadoDivisao[coluna] = divisaoLinhas[coluna] / matriz[linha+1][coluna];
                    
                if( divisaoLinhas[coluna] < matriz[linha+1][coluna])
                     resultadoDivisao[coluna] = matriz[linha+1][coluna] /  divisaoLinhas[coluna];
                     
               if( divisaoLinhas[coluna] == matriz[linha+1][coluna])
                     resultadoDivisao[coluna] = divisaoLinhas[coluna] / matriz[linha+1][coluna];
                     
            }
        
        int elementoVetor;
        int primeiroAcesso = 1;
        int elementosIgual = 1;
      
       for (i = 1; i <= ordem; i++) 
       {
           if(primeiroAcesso == 1)
           {
               elementoVetor = resultadoDivisao[i];
               primeiroAcesso = 0;
           }
           else
           {
               if( elementoVetor ==  resultadoDivisao[i])
               {
                     elementosIgual++;
               }
                else
                    return 1;
           }
        }
        if(elementosIgual == ordem)
            return 0; // se a quantidade de elementos do vetor são iguais ao tamanho da            linha todos são iguais
        }
    }
    
     void trocarLinhas(int contLinhas) // trocar linhas da matriz
    {
       int aux;
       for(j = 0; j <= ordem+1; j++)
       {
           aux = matriz[contLinhas][j];
           matriz[contLinhas][j]= matriz[contLinhas+1][j];
           matriz[contLinhas+1][j]= aux;
       }
       
    }
int main() {
  
    printf("\nEscreva a ordem da matriz: ");
    scanf("%d", &ordem);
    fflush(stdin);
    printf("\nEscreva os elementos da matriz aumentada:\n\n");
    for(i=1;i<=ordem;i++)
    {
        for(j=1;j<=(ordem+1);j++)
        {
            printf("matriz[%d][%d] : ", i,j);
            scanf("%f",&matriz[i][j]);
            fflush(stdin);
        }
    }
    
    if(ehAplicavel() == 0)
    {
        printf("Não é possivel resolver o sistema!");
        return 0;
    }
    
    if(matriz[1][1] == 0)
    {
        int contLinhas = 1; //contador de linhas para trocar as linhas de lugares para tirar o zero da diagonal
        while(contLinhas < ordem && matriz[1][1]==0)
        {
             trocarLinhas(contLinhas);
             contLinhas++;
        }
        if(matriz[1][1]== 0) // teste
        {
             printf("Não é possivel resolver o sistema!");
            return 0;
        }
    }
     float linhaMatriz[ordem];
     memset(linhaMatriz, 0, sizeof(linhaMatriz));
        j = 1;
        i = 1;
        int colunaAtual = 1;
    
        // solução da matriz    
        while(i <= ordem)
        {
            float valorDiagonal;
         
            for(j=1;j<=(ordem+1);j++)
            {
                 if(i == j) // se i = j quer dizer que estamos na diagonal
                 {
                    valorDiagonal = matriz[i][j];
                    if(valorDiagonal == 0)
                    {
                          int contLinhas = 1; //contador de linhas para trocar as linhas de lugares para tirar o zero da diagonal
                        while(contLinhas < ordem && matriz[1][1]==0)
                        {
                             trocarLinhas(contLinhas);
                             contLinhas++;
                        }
                        if(matriz[1][1]== 0) // teste
                        {
                             printf("Não é possivel resolver o sistema!");
                            return 0;
                        }
                    }
                    
                    for(j=1;j<=(ordem+1);j++) // percorre as colunas da matriz
                    {
                        matriz[i][j] = matriz[i][j] / valorDiagonal; 
                        //divide a posição atual pelo valor da diagonal
                        
                        linhaMatriz[j-1] = matriz[i][j];;
                    }
                    break;
                 }
            }
            
            for(int seqLinha = 1; seqLinha <= ordem; seqLinha++)
            {
                float valor;
                
                if(seqLinha != colunaAtual && matriz[seqLinha][colunaAtual] != 0)
                {
                    valor = (-matriz[seqLinha][colunaAtual]);
                    for(int coluna=1;coluna<=(ordem+1);coluna++) // percorre as colunas da matriz
                        {
                            matriz[seqLinha][coluna] = (linhaMatriz[coluna-1] * valor) +  matriz[seqLinha][coluna];
                        }
                }
            }
            colunaAtual++;
            i++; // incrementador de linha da
        }
    
    
    // printa a matriz
    for( i=1;i<=ordem;i++)
    {
        for(j=1;j<=ordem+1;j++)
        {
            if(j!=ordem+1)
            {
            printf("%0.2f   ", matriz[i][j]);
            }
            else
            {
                printf("%0.2f \n", matriz[i][j]);

            }
        }
        printf("\n");
    }
    return 0;
}